# Example training configuration for Faster R-CNN
# Paths
project_root: "."
data:
  images:
    train_dir: "new_whales_rcnn/images/Train"
    val_dir: "new_whales_rcnn/images/Validation"
    test: "new_whales_rcnn/images/test"
  annotations:
    train_json: "new_whales_rcnn/annotations/instances_Train.json"
    val_json: "new_whales_rcnn/annotations/instances_Validation.json"
    test_json: "new_whales_rcnn/annotations/test"


# Training
training:
  epochs: 5
  batch_size: 2
  lr: 0.005
  momentum: 0.9
  weight_decay: 0.0005
  lr_step_size: 3
  lr_gamma: 0.1
  num_workers: 1
  seed: 42
  amp: true
  sample_vis_count: 4
  sample_vis_thresh: 0.1
  eval_map_every: 1  # compute COCO mAP every N epochs (0 to disable)
  transforms:
    resize:
      min_size: 800
      max_size: 1333
    hflip_p: 0.5
    short_sizes: [640, 672, 704, 736, 768, 800]
    max_size: 1333
    color_jitter: { p: 0.5, brightness: 0.2, contrast: 0.2, saturation: 0.2, hue: 0.02 }
    use_iou_crop: false
    min_iou: 0.3

# Model
model:
  name: "fasterrcnn_resnet50_fpn_v2"
  pretrained: yes
  num_classes: 2  # background + whale

# Checkpointing / logging
output:
  dir: "outputs"
  experiment: "fasterrcnn_test"
  save_every: 1
  resume: "resume"  # path to checkpoint to resume from

# Early stopping to avoid overfitting (configured for fine-tuning)
early_stopping:
  enabled: true
  # monitor: choose metric to monitor. Recommended: 'val_loss' (default) or 'val_mAP'.
  # The Trainer will also accept legacy names like 'map' or 'mAP' and map them to 'val_mAP'.
  monitor: "val_loss"
  eval_map_every: 1
  # mode is auto-detected from monitor: 'min' for losses, 'max' for mAP-like metrics
  # If you explicitly want to override, set mode: 'min' or 'max'
  mode: null
  # minimum change to qualify as improvement (default 1e-4)
  min_delta: 0.0001
  # patience in epochs (default 10)
  patience: 10
  # whether to restore best weights at the end of training
  restore_best_weights: true
  # prefer val_mAP automatically if available (will switch monitor to 'val_mAP')
  prefer_val_mAP: true

cross_validation:
  enabled: true     # habilita CV
  folds: 5          # n√∫mero de folds
